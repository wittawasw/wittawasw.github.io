<!DOCTYPE html>
<html lang="en">

  <head>
  <script type="text/javascript">
    var host = "wittawasw.com";
    if ((host == window.location.host) && (window.location.protocol != "https:"))
        window.location.protocol = "https";
  </script>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="I work mostly on Ruby, Elixir. This site will be just a memo for me and for someone out there who's interested in similar topics to mine.">
  <meta property="og:title" content="Easy HTTPS Proxy Using Caddy on DigitalOcean."/>
<meta property="og:type" content="article"/>
<meta property="og:image" content="http://localhost:4000/images/home.jpg"/>
<meta property="og:url" content="http://localhost:4000/blog/2017/04/28/easy-https-proxy-using-caddy-on-digitalocean/"/>

<meta property="og:site_name" content="wittawasw"/>
<meta property="og:description" content="If you need a good HTTPS proxies that come with auto Let's Encrypt certificates and already a user of DigitalOcean. Here I've got an easy but solid way to deploy one. Already using this on a production servers with no problem so far."/>

<meta property="article:author" content="https://www.facebook.com/wittawasw" />

<meta name="author" content="Wittawas Wisarnkanchana"/>
<meta name="description" content="If you need a good HTTPS proxies that come with auto Let's Encrypt certificates and already a user of DigitalOcean. Here I've got an easy but solid way to deploy one. Already using this on a production servers with no problem so far."/>
  <meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@wittawasw">
<meta name="twitter:creator" content="@wittawasw">
<meta name="twitter:title" content="Easy HTTPS Proxy Using Caddy on DigitalOcean.">
<meta name="twitter:description" content="If you need a good HTTPS proxies that come with auto Let's Encrypt certificates and already a user of DigitalOcean. Here I've got an easy but solid way to deploy one. Already using this on a production servers with no problem so far.">
<meta name="twitter:image:src" content="http://localhost:4000/images/home.jpg">


  <title>Easy HTTPS Proxy Using Caddy on DigitalOcean. - wittawasw</title>

  <link rel="canonical" href="http://localhost:4000/blog/2017/04/28/easy-https-proxy-using-caddy-on-digitalocean/">
  <link rel="stylesheet" href="/css/main.css">

  <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
  <!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-35957895-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->

</head>


  <body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header page-scroll">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">wittawasw</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        <li>
          <a href="/">Home</a>
        </li>
        <li>
          <a href="/about">About</a>
        </li>
      </ul>
    </div>
    <!-- /.navbar-collapse -->
  </div>
  <!-- /.container -->
</nav>


    <!-- Post Header -->
<header
  class="intro-header"
  style="background-image: url('/images/home.jpg')"
>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-heading">
          <h1>Easy HTTPS Proxy Using Caddy on DigitalOcean.</h1>
          
          <span class="meta">April 28, 2017</span>
        </div>
      </div>
    </div>
  </div>
</header>

<!-- Post Content -->
<article>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        
          <a href="/categories/https">
            <span class="label label-info" style="margin-right: 5px;">
              https
            </span>
          </a>
        
          <a href="/categories/proxy">
            <span class="label label-info" style="margin-right: 5px;">
              proxy
            </span>
          </a>
        
          <a href="/categories/digitalocean">
            <span class="label label-info" style="margin-right: 5px;">
              digitalocean
            </span>
          </a>
        
          <a href="/categories/caddy">
            <span class="label label-info" style="margin-right: 5px;">
              caddy
            </span>
          </a>
        
          <a href="/categories/webserver">
            <span class="label label-info" style="margin-right: 5px;">
              webserver
            </span>
          </a>
        
          <a href="/categories/docker">
            <span class="label label-info" style="margin-right: 5px;">
              docker
            </span>
          </a>
        
      </div>
    </div>
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <blockquote>
  <p>The setup need DigitalOcean account and Domain on DigitalOcean’s nameserver.
Otherwise, it’d need a different step to complete.</p>
</blockquote>

<p>If you need a good HTTPS proxies that come with auto <a href="https://letsencrypt.org/">Let’s Encrypt</a>
certificates and already a user of DigitalOcean. Here I’ve got an easy but solid
way to deploy one. Already using this on a production servers with no problem
so far.</p>

<blockquote>
  <p><a href="https://caddyserver.com/">Caddy</a> server is already the easiest server that
you can <a href="https://caddyserver.com/tutorial">install</a> on Linux. But I decided to
use docker with it because it’s easier for me to control volume and settings.</p>
</blockquote>

<h3 id="from-beginning-to-deploy">From beginning to deploy.</h3>
<ul>
  <li>Setup domain to use DigitalOcean’s nameserver.</li>
  <li>Create droplet using pre-defined <code class="highlighter-rouge">docker</code> droplet.</li>
  <li>Add <code class="highlighter-rouge">A</code> or <code class="highlighter-rouge">CNAME</code> that point domain to droplet’s IP address.</li>
  <li><code class="highlighter-rouge">SSH</code> into droplet and create directory <code class="highlighter-rouge">caddy</code> in home directory.</li>
  <li>Enable <code class="highlighter-rouge">ufw</code> port <code class="highlighter-rouge">443</code>.</li>
  <li>Create DigitalOcean auth token and keep it close.</li>
  <li>Create <code class="highlighter-rouge">Caddyfile</code> in home directory.</li>
  <li>Create <code class="highlighter-rouge">docker-compose.yml</code> in home directory.</li>
  <li>From home directory, use command <code class="highlighter-rouge">docker-compose up -d</code></li>
  <li>Caddy’s online. That’s it. No more hassle.</li>
</ul>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">Caddyfile</span></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"># proxy's url (domain that we set record earlier.)
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">front-end-url:443 &#x7b;
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">  # backend's servers can be single or multiple servers
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">  # SSL terminate here.
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">  proxy / backend-url-1:80 backend-url-2:80 backend-url-3:80 &#x7b;
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">    policy round_robin
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">    header_upstream Host &#x7b;host&#x7d;
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">    header_upstream X-Real-IP &#x7b;remote&#x7d;
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line">    header_upstream X-Forwarded-For &#x7b;remote&#x7d;
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line">    header_upstream X-Forwarded-Proto &#x7b;scheme&#x7d;
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line">  &#x7d;
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line">  gzip
</div></div><div data-line="14" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="15" class="code-highlight-row numbered"><div class="code-highlight-line">  tls &#x7b;
</div></div><div data-line="16" class="code-highlight-row numbered"><div class="code-highlight-line">   # verify ssl certificate using dns from DigitalOcean really save me from a lot of pain.
</div></div><div data-line="17" class="code-highlight-row numbered"><div class="code-highlight-line">   dns digitalocean
</div></div><div data-line="18" class="code-highlight-row numbered"><div class="code-highlight-line">  &#x7d;
</div></div><div data-line="19" class="code-highlight-row numbered"><div class="code-highlight-line">&#x7d;</div></div></pre></div></figure>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">docker-compose.yml</span></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="s">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3'</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="s">services</span><span class="pi">:</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="s">proxy</span><span class="pi">:</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="s">image</span><span class="pi">:</span> <span class="s">zzrot/alpine-caddy</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="s">ports</span><span class="pi">:</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="pi">-</span>   <span class="s">443:443</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="s">volumes</span><span class="pi">:</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="pi">-</span>   <span class="s">./Caddyfile:/etc/Caddyfile</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="pi">-</span>   <span class="s">./caddy:/root/.caddy</span>
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="c1"># don't forget to add volume, otherwise you will request new certificate</span>
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="c1"># every time server restart and exceed letsencrypt quota in the process.</span>
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="s">environment</span><span class="pi">:</span>
</div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="pi">-</span> <span class="s">DO_AUTH_TOKEN=&lt;DO_ACCOUNT_TOKEN&gt;</span>
</div></div><div data-line="14" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="c1"># get this token from setting page.</span></div></div></pre></div></figure>

<h3 id="where-to-go-from-here">Where to go from here</h3>
<p>See official <a href="https://caddyserver.com/docs">documentation</a> of Caddy. There’s a
lot of features that can be easily setup using simple directives.</p>


          <hr>

          <ul class="pager">
            
            <li class="previous">
              <a
                href="/blog/2016/07/03/fizzbuzz-first-time/"
                data-toggle="tooltip"
                data-placement="top"
                title="FizzBuzz First Time."
              >
                &larr; Previous Post
              </a>
            </li>
            
            
          </ul>

      </div>
    </div>
  </div>
</article>

<hr>

<section id="disqus">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    // Required: on line below, replace text in quotes with your forum shortname
    var disqus_shortname = 'wittawasw';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    </div>
  </div>
</section>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://twitter.com/wittawasw">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://www.facebook.com/wittawasw">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://github.com/wittawasw">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy; wittawasw </p>
                <p class="copyright text-muted">
                <a rel="license" href="http://creativecommons.org/licenses/by/4.0/" class="text-center">
  <img alt="Creative Commons License"
       style="border-width:0;width: 100px; position:relative;margin:auto;"
       src="https://i.creativecommons.org/l/by/4.0/88x31.png"
  />
</a>
<br />
<span xmlns:dct="http://purl.org/dc/terms/"
      href="http://purl.org/dc/dcmitype/Text"
      property="dct:title"
      rel="dct:type">
  All contents in this blog are licensed under a
  <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
    Creative Commons Attribution 4.0 International License
  </a>.
</span>
<br/>
<span>
  Also, special thanks to
  <a href="http://startbootstrap.com/">
    StartBootstrap.com
  </a>
  for this beautiful
  <a href="http://startbootstrap.com/template-overviews/clean-blog/">
    CleanBlog
  </a> theme.
</span>

                </p>
            </div>
        </div>
        <div class="row text-center">
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>


  </body>

</html>
