<!DOCTYPE html>
<html lang="en">

  <head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="I'm currently employed as Ruby on Rails developer at codemy.net. This site will be just a memo for me and for someone out there who's interested in similar topics to mine.">
  <meta property="og:site_name" content="wittawasw"/>
<meta property="og:title" content="Backend once and Client everywhere with Rails-API">
<meta property="og:type" content="article">
<meta property="og:image" content="http://blog.wittawasw.com/images/home.jpg">
<meta property="og:url" content="http://blog.wittawasw.com/blog/2014/04/10/backend-once-and-client-everywhere-with-rails-api/">

<meta property="og:site_name" content="wittawasw">
<meta property="og:description" content="Normally when you build a web or mobile application, you will have to build seperate backend because most web framework originally means to generate data along with dynamic HTML templates. But if we think that web application is just a form of native applications and we treat it that way, generate only data and just use static HTML to handle the logic. This way, we can reuse our backend to almost every native applications we want....">

<meta property="article:author" content"https://www.facebook.com/wittawasw">

<meta name="author" content="Wittawas Wisarnkanchana">
<meta name="description" content="Normally when you build a web or mobile application, you will have to build seperate backend because most web framework originally means to generate data along with dynamic HTML templates. But if we think that web application is just a form of native applications and we treat it that way, generate only data and just use static HTML to handle the logic. This way, we can reuse our backend to almost every native applications we want....">
  <meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@wittawasw">
<meta name="twitter:creator" content="@wittawasw">
<meta name="twitter:title" content="Backend once and Client everywhere with Rails-API">
<meta name="twitter:description" content="Normally when you build a web or mobile application, you will have to build seperate backend because most web framework originally means to generate data along with dynamic HTML templates. But if we think that web application is just a form of native applications and we treat it that way, generate only data and just use static HTML to handle the logic. This way, we can reuse our backend to almost every native applications we want....">
<meta name="twitter:image:src" content="http://blog.wittawasw.com/images/home.jpg">


  <title>Backend once and Client everywhere with Rails-API - wittawasw</title>

  <link rel="canonical" href="http://blog.wittawasw.com/blog/2014/04/10/backend-once-and-client-everywhere-with-rails-api/">
  <link rel="stylesheet" href="/css/main.css">

  <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
  <!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-35957895-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->

</head>


  <body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header page-scroll">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">wittawasw</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        <li>
          <a href="/">Home</a>
        </li>
        
        <li>
          <a href="/about.html">About</a>
        </li>
        
      </ul>
    </div>
    <!-- /.navbar-collapse -->
  </div>
  <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header" style="background-image: url('/images/home.jpg')">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-heading">
          <h1>Backend once and Client everywhere with Rails-API</h1>
          
          <span class="meta">April 10, 2014</span>
        </div>
      </div>
    </div>
  </div>
</header>

<!-- Post Content -->
<article>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        
          <span class="label label-info" style="margin-right: 5px;"> backend </span>
        
          <span class="label label-info" style="margin-right: 5px;"> rails </span>
        
          <span class="label label-info" style="margin-right: 5px;"> api </span>
        
          <span class="label label-info" style="margin-right: 5px;"> angularjs </span>
        
      </div>
    </div>
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <p>Normally when you build a web or mobile application, you will have to build seperate backend because most web framework originally means to generate data along with dynamic HTML templates. But if we think that web application is just a form of native applications and we treat it that way, generate only data and just use static HTML to handle the logic. This way, we can reuse our backend to almost every native applications we want. </p>

<blockquote>
  <p>If you’re asking for some BIG example out there that use this trick, Try <a href="https://twitter.com">Twitter.com</a></p>
</blockquote>

<h2 id="why-use-rails-">Why use Rails ?</h2>
<ul>
  <li>Huge resources and communities that provide almost everything you want to build applications.</li>
  <li>Very clean Routing and easy to use. </li>
  <li>Secure enough.</li>
  <li>Easiest (in my opinion) to debug using <a href="https://github.com/charliesome/better_errors">better_errors</a> and <a href="https://github.com/banister/binding_of_caller">binding_of_caller</a>.</li>
  <li>I want to use Rails, that’s all.</li>
</ul>

<blockquote>
  <p>Beyond this point require Ruby and Rails installed already.</p>
</blockquote>

<h2 id="getting-started-rails-api">Getting started: Rails-API</h2>
<p>Assuming that you’ve already installed Ruby(1.9.3+) and Rails(3.2+) already, today we use this nicely done gem to help us prepare new application</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">shell</span></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line">$ gem install rails-api
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">$ rails-api new contact-api</div></div></pre></div></figure>

<p>with Rails-API we’ll get only essential part of Rails to build API instead of getting all heavy and unnecessary features from traditional Rails. And now we have our newly created app called <a href="">contact-api</a></p>

<p>Then put this on your gemfile and run “bundle install”, this will make your life a lot easier.</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">Gemfile</span></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="n">gem</span> <span class="s1">&#39;better_errors&#39;</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="n">gem</span> <span class="s1">&#39;binding_of_caller&#39;</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="k">end</span></div></div></pre></div></figure>

<h2 id="rails-time">Rails time</h2>
<p>Since there’s only API, so we don’t need to setup things like HTML template or homepage here. Let’s generate contact by using </p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">shell</span></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line">$ rails g scaffold contact name:string email:string 
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">$ rake db:migrate</div></div></pre></div></figure>

<p>If you’re running on Rails 3+, you need to put these line in your app/model/contact.rb</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">app/model/contact.rb</span></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">attr_accessible</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:email</span></div></div></pre></div></figure>

<p>If Rails 4+, in app/controllers/contacts_controller</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">app/controllers/contacts_controller</span></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="k">def</span> <span class="nf">create</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="vi">@contact</span> <span class="o">=</span> <span class="no">Contact</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">contact_params</span><span class="p">)</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="k">if</span> <span class="vi">@contact</span><span class="o">.</span><span class="n">save</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="n">render</span> <span class="ss">json</span><span class="p">:</span> <span class="vi">@contact</span><span class="p">,</span> <span class="ss">status</span><span class="p">:</span> <span class="ss">:created</span><span class="p">,</span> <span class="ss">location</span><span class="p">:</span> <span class="vi">@contact</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="k">else</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="n">render</span> <span class="ss">json</span><span class="p">:</span> <span class="vi">@contact</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span> <span class="ss">status</span><span class="p">:</span> <span class="ss">:unprocessable_entity</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="k">end</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="k">end</span>
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kp">private</span>
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="k">def</span> <span class="nf">contact_params</span>
</div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:contact</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:email</span><span class="p">)</span>
</div></div><div data-line="14" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="k">end</span></div></div></pre></div></figure>

<p>and then run your rails server with</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">shell</span></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line">$ rails s</div></div></pre></div></figure>

<p>Try access by your browser to <a href="http://localhost:3000/contacts/">localhost:3000/contacts</a> and you will see an empty JSON “[]” there. Now let’s try to make it error by access to <a href="http://localhost:3000/contacts/test">localhost:3000/contacts/test</a> and you’ll see error like below.
<img class="center" src="/images/post/contact-error.png" alt="" title="contact error" /></p>

<p>Obviously, it’s a “Not found” error because we try to access object Contact that have id = “test” which doesn’t exist. On the right side, you’ll see a very handy shell that you can play with it like how you play in “rails console”. And since we have our console right before our eyes, we should try something.</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">Better-error shell</span></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="no">Contact</span><span class="o">.</span><span class="n">create!</span><span class="p">(</span><span class="nb">name</span><span class="ss">:&quot;John&quot;</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span><span class="s2">&quot;fathername@example.com&quot;</span><span class="p">)</span></div></div></pre></div></figure>

<p>and result is</p>

<p><img class="center" src="/images/post/contact-create.png" alt="" title="contact create" />
Now we can try to access <a href="http://localhost:3000/contacts/1">localhost:3000/contacts/1</a> and you will see JSON of your newly created contact.
<img class="center" src="/images/post/contact-1.png" alt="title: 'image'" /></p>

<h2 id="prepare-for-cors">Prepare for CORS</h2>
<p>What we trying to do here is to actually access to Rails server(<a href="http://localhost:3000">localhost:3000</a>) from another server instance. So it’ll inevitably face with <a href="http://en.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> problem and here we’ll cover that problem before it’s occured with <a href="https://github.com/cyu/rack-cors">rack-cors</a></p>

<p>Put this line in Gemfile</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">Gemfile</span></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">gem</span> <span class="s1">&#39;rack-cors&#39;</span><span class="p">,</span> <span class="ss">:require</span> <span class="o">=&gt;</span> <span class="s1">&#39;rack/cors&#39;</span></div></div></pre></div></figure>

<p>then</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">bundle</span> <span class="n">install</span></div></div></pre></div></figure>

<p>Finally, put this code in config/application.rb inside class Application and it’ll look like this.</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">config/application.rb</span></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="k">module</span> <span class="nn">ContactApi</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="k">class</span> <span class="nc">Application</span> <span class="o">&lt;</span> <span class="no">Rails</span><span class="o">::</span><span class="no">Application</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="c1">#.....</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="n">config</span><span class="o">.</span><span class="n">middleware</span><span class="o">.</span><span class="n">use</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Cors</span> <span class="k">do</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="n">allow</span> <span class="k">do</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="n">origins</span> <span class="s1">&#39;*&#39;</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="n">resource</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="ss">:headers</span> <span class="o">=&gt;</span> <span class="ss">:any</span><span class="p">,</span> <span class="ss">:methods</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:get</span><span class="p">,</span> <span class="ss">:post</span><span class="p">,</span> <span class="ss">:options</span><span class="o">]</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="k">end</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="k">end</span>
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="k">end</span>
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="k">end</span></div></div></pre></div></figure>

<p>Restart Rails server and it’ll become accessible from every origin.</p>

<h2 id="html-time">HTML time</h2>
<p>It’s time to build our static site to serve as a native client for contact-api. But before that, we have to choose which server to serve our static files. It can be many things such as another Rails, Node.js, PHP, etc. Whichever is fine but I choose to go with <a href="http://golang.org">Go</a>, no reason, I just want it. (See details of how easy Go handle static file in <a href="http://wittawasw.com/blog/2014/04/09/free-and-easy-static-website-hosting-using-google-app-engine-and-golang/">previous post</a>)</p>

<p>Below is my jsFiddle demo using angularjs as a client to add contact object by using Rails backend as API only. Or you can play a demo at this Google App Engine <a href="http://rails-angular-backend-demo.appspot.com/">Site</a></p>

<p>All the code can be found at <a href="https://github.com/wittawasw/rails-angular-backend-demo">Github</a></p>

<iframe style="width: 100%; height: 300px" frameborder="0" seamless="seamless" src="http://jsfiddle.net/jeNq2/embedded/js,resources,html,css,result/light/"></iframe>



          <hr>

          <ul class="pager">
            
            <li class="previous">
              <a href="/blog/2014/04/09/free-and-easy-static-website-hosting-using-google-app-engine-and-golang/" data-toggle="tooltip" data-placement="top" title="Free and easy static website hosting using Google App Engine and Go's runtime">&larr; Previous Post</a>
            </li>
            
            
            <li class="next">
              <a href="/blog/2015/03/24/upgraded-to-octopress-3-0rc/" data-toggle="tooltip" data-placement="top" title="Upgraded to Octopress 3.0rc">Next Post &rarr;</a>
            </li>
            
          </ul>

      </div>
    </div>
  </div>
</article>

<hr>

<section id="disqus">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    // Required: on line below, replace text in quotes with your forum shortname
    var disqus_shortname = 'wittawasw';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    </div>
  </div>
</section>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://twitter.com/wittawasw">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://www.facebook.com/wittawasw">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://github.com/wittawasw">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy; wittawasw 2015</p>
                <p class="copyright text-muted">
                <a rel="license" href="http://creativecommons.org/licenses/by/4.0/" class="text-center">
  <img alt="Creative Commons License" style="border-width:0;width: 100px; position:relative;margin:auto;" src="https://i.creativecommons.org/l/by/4.0/88x31.png" />
</a>
<br />
<span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type">All contents in this blog are licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.

                </p>
            </div>
        </div>
        <div class="row text-center">
            
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>


  </body>

</html>
